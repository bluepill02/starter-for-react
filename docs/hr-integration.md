# HR Integration Guide

This document provides comprehensive guidance for HR teams using the Recognition System for employee performance tracking, export capabilities, and compliance requirements.

## Overview

The Recognition System provides HR teams with enterprise-grade tools for:
- **Evidence-based performance insights** with verifiable recognition data
- **Privacy-compliant exports** with configurable anonymization
- **Audit trails** for compliance and governance
- **Manager verification workflows** to ensure data quality
- **Anti-abuse protections** to maintain system integrity

## Export Formats and Capabilities

### PDF Reports

PDF exports provide formatted recognition reports suitable for:
- Performance reviews and 1:1 meetings
- Promotion/compensation discussions
- Annual reviews and goal setting
- Manager dashboards and team overviews

#### PDF Export Features
- **Professional formatting** with company branding capability
- **Recognition metrics** including weights, verification status, and trends
- **Verifier stamps** showing manager approval with timestamps
- **Privacy controls** with configurable PII inclusion
- **Time-limited access** with automatic expiration (default 24 hours)

#### Sample PDF Content Structure
```
Recognition Report - [Employee Name]
Generated: [Timestamp] | Report ID: [Hashed ID]
Privacy Level: [Public/Private] | Verifier: [Role]

SUMMARY METRICS
- Recognitions Received: X (Total Weight: Y.Z)
- Recognitions Given: X (Total Weight: Y.Z) 
- Verification Rate: X% (Z of Y verified)
- Most Common Tags: [tag1, tag2, tag3]

DETAILED RECOGNITIONS
[Date] | From: [Name/Hashed] | Tags: [list] | Weight: X.X | Status: VERIFIED
Reason: [Recognition text with evidence indicators]
Verified by: [Manager Name/Hashed] on [Date]
---
[Additional entries...]

AUDIT INFORMATION
Generated by: [Requester Role] on [Timestamp]
Export includes: [Public/Private data description]
Data retention: Expires [Date]
```

### CSV Exports

CSV exports provide structured data for:
- HRIS integrations and data analysis
- Performance analytics and reporting
- Bulk data processing and visualization
- Historical trend analysis

#### CSV Export Format
```csv
# Recognition Export Report
# Generated: 2023-12-01T10:30:00.000Z
# User: hashed-user-id-12345678
# Privacy Level: Anonymized/Full
# Verifier: MANAGER/ADMIN
# Record Count: 150
# Retention: Expires 2023-12-02T10:30:00.000Z

Date,Type,Other Party,Other Party Email,Tags,Recognition Weight,Status,Verification Date,Verifier,Evidence Included
2023-11-01,Received,hashed-giver-id,masked@company.com,"teamwork,innovation",2.0,VERIFIED,2023-11-02,hashed-manager-id,Yes
2023-10-15,Given,hashed-recipient-id,masked@company.com,"leadership",1.5,VERIFIED,2023-10-16,hashed-manager-id,No
```

#### CSV Privacy Levels
- **Full Data (Admin/Self only)**: Real names, emails, complete recognition text
- **Anonymized (Default)**: Hashed IDs, masked emails, sanitized content
- **Public Only**: Excludes private recognitions and sensitive metadata

## Privacy and Hashing

### Hashed Identifiers
All exports use SHA-256 hashed identifiers to protect user privacy while maintaining data relationships:

```typescript
// User ID Hashing
const hashUserId = (userId: string): string => {
  return crypto.createHash('sha256')
    .update(userId + process.env.HASH_SALT)
    .digest('hex')
    .substring(0, 16); // 16-character prefix for readability
};

// Example: "user@company.com" -> "a7b8c9d0e1f2g3h4"
```

### Email Masking
Email addresses are masked based on privacy level:
- **Full**: `john.doe@company.com`
- **Masked**: `j***@company.com`
- **Hashed**: `hashed-user-id-a7b8c9d0`

### Content Sanitization
Recognition text and reasons are sanitized to remove:
- Personal identifiable information (PII)
- Sensitive project names or confidential information
- Performance improvement areas (when requested)
- Internal system references

## Access Controls and Permissions

### Role-Based Export Access

| Role | Self Export | Team Export | Organization Export | Private Data Access |
|------|------------|-------------|-------------------|-------------------|
| **USER** | ✅ Public only | ❌ | ❌ | ❌ |
| **MANAGER** | ✅ Full access | ✅ Team members | ❌ | ✅ Direct reports |
| **ADMIN** | ✅ Full access | ✅ All users | ✅ All users | ✅ All users |
| **HR** | ✅ Full access | ✅ All users | ✅ All users | ✅ Configurable |

### Export Request Validation
```typescript
interface ExportPermissions {
  canExportUser(requesterId: string, targetUserId: string): boolean;
  canIncludePrivateData(requesterId: string, targetUserId: string): boolean;
  getMaxRetentionHours(requesterRole: string): number;
}

// Permission validation logic
const validateExportRequest = async (request: ExportRequest) => {
  const requester = await getUserById(request.requesterId);
  const isOwnProfile = request.requesterId === request.targetUserId;
  const isManager = requester.role === 'MANAGER' && 
    await isDirectReport(request.requesterId, request.targetUserId);
  const isAdmin = requester.role === 'ADMIN' || requester.role === 'HR';
  
  return isOwnProfile || isManager || isAdmin;
};
```

## Audit Trail and Compliance

### Export Audit Events
Every export request generates comprehensive audit entries:

```typescript
interface ExportAuditEntry {
  event: 'PROFILE_EXPORTED' | 'EXPORT_UNAUTHORIZED' | 'EXPORT_EXPIRED';
  timestamp: string;
  requesterId: string; // Hashed
  targetUserId: string; // Hashed
  requesterRole: 'USER' | 'MANAGER' | 'ADMIN' | 'HR';
  exportFormat: 'pdf' | 'csv';
  includePrivateData: boolean;
  recordCount: number;
  fileId?: string; // Hashed
  expirationDate: string;
  ipAddress: string; // Hashed
  userAgent: string; // Sanitized
}
```

### Audit Query Examples
```sql
-- Recent export activity by HR team
SELECT timestamp, requesterRole, targetUserId, recordCount 
FROM audit_trail 
WHERE event = 'PROFILE_EXPORTED' 
  AND requesterRole = 'HR' 
  AND timestamp > DATE_SUB(NOW(), INTERVAL 30 DAY);

-- Unauthorized access attempts
SELECT timestamp, requesterId, targetUserId, requesterRole
FROM audit_trail 
WHERE event = 'EXPORT_UNAUTHORIZED'
ORDER BY timestamp DESC;
```

### Retention and Cleanup
- **Export files**: Auto-deleted after expiration (1-168 hours based on role)
- **Audit entries**: Retained for 7 years for compliance
- **User consent**: Tracked with audit entries for GDPR compliance

## Integration with HRIS Systems

### API Endpoints for Bulk Operations

#### Bulk Export API
```typescript
POST /api/hr/bulk-export
Authorization: Bearer <hr-admin-token>
Content-Type: application/json

{
  "userIds": ["user1", "user2", ...], // Optional: all if omitted
  "format": "csv",
  "includePrivateData": false,
  "dateRange": {
    "start": "2023-01-01",
    "end": "2023-12-31"
  },
  "filters": {
    "minWeight": 1.0,
    "verifiedOnly": true,
    "departments": ["Engineering", "Sales"]
  }
}
```

#### Webhook Configuration
```typescript
// Configure webhook for export completion
POST /api/hr/webhooks
{
  "url": "https://hris.company.com/recognition-webhook",
  "events": ["export.completed", "export.failed"],
  "secret": "webhook-signing-secret"
}

// Webhook payload
{
  "event": "export.completed",
  "timestamp": "2023-12-01T10:30:00.000Z",
  "exportId": "export-12345",
  "downloadUrl": "https://storage.company.com/exports/signed-url",
  "expiresAt": "2023-12-02T10:30:00.000Z",
  "recordCount": 1500,
  "fileSize": 2048576
}
```

### SCIM Integration
The system supports SCIM 2.0 for automated user provisioning and role management:

```typescript
// SCIM user attributes for recognition permissions
{
  "schemas": ["urn:ietf:params:scim:schemas:core:2.0:User"],
  "id": "user123",
  "userName": "john.doe@company.com",
  "name": {
    "givenName": "John",
    "familyName": "Doe"
  },
  "emails": [{
    "value": "john.doe@company.com",
    "primary": true
  }],
  "urn:company:schemas:recognition": {
    "role": "MANAGER",
    "department": "Engineering",
    "directReports": ["user456", "user789"],
    "canExportTeam": true,
    "maxExportRetention": 72
  }
}
```

## Performance Analytics for HR

### Key Metrics Dashboard

#### Recognition Velocity
- **Recognition Rate**: Recognitions per employee per month
- **Response Time**: Average time between giving and receiving recognition
- **Verification Rate**: Percentage of recognitions verified by managers
- **Weight Distribution**: Analysis of recognition value distribution

#### Team Insights
- **Cross-team Recognition**: Recognition patterns across departments
- **Manager Engagement**: Verification and recognition giving rates by managers
- **Tag Analysis**: Most common recognition categories and trends
- **Reciprocity Scores**: Balanced recognition giving/receiving ratios

#### Sample Analytics Query
```sql
-- Monthly recognition trends by department
SELECT 
  DATE_FORMAT(created_at, '%Y-%m') as month,
  department,
  COUNT(*) as total_recognitions,
  AVG(weight) as avg_weight,
  COUNT(CASE WHEN status = 'VERIFIED' THEN 1 END) / COUNT(*) * 100 as verification_rate
FROM recognitions r
JOIN users u ON r.giver_user_id = u.id
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 12 MONTH)
GROUP BY month, department
ORDER BY month DESC, department;
```

## Compliance and Legal Considerations

### Data Protection (GDPR/CCPA)
- **Right to Access**: Users can export their complete recognition data
- **Right to Rectification**: Manager verification serves as data correction mechanism  
- **Right to Erasure**: Anonymization process for user data deletion
- **Data Portability**: CSV/PDF exports support data portability requirements
- **Consent Management**: Explicit consent tracking for recognition participation

### Employment Law Compliance
- **Equal Opportunity**: Anti-bias monitoring in recognition patterns
- **Performance Documentation**: Recognition data as supplemental performance evidence
- **Dispute Resolution**: Complete audit trail for employment-related disputes
- **Whistleblower Protection**: Anonymous recognition reporting capabilities

### Data Retention Policies
```typescript
interface RetentionPolicy {
  recognitionData: '7 years'; // Employment records retention
  auditTrails: '10 years'; // Compliance and legal requirements
  exportFiles: '1-168 hours'; // Temporary access based on role
  userConsent: '7 years'; // GDPR consent documentation
  abuseReports: '10 years'; // HR investigation records
}
```

## Troubleshooting and Support

### Common Export Issues

#### "Insufficient Permissions"
- Verify requester role and target user relationship
- Check SCIM synchronization for role updates
- Confirm manager/direct report relationships

#### "No Data Available"
- Verify recognition data exists in specified date range
- Check privacy settings and verification status filters
- Confirm user has participated in recognition system

#### "Export Expired"
- Re-request export with appropriate retention period
- Verify role-based retention limits
- Check if download was attempted after expiration

### Export API Error Codes
```typescript
// Standard error responses
{
  "error": "INSUFFICIENT_PERMISSIONS",
  "message": "User lacks permission to export target profile",
  "code": 403,
  "details": {
    "requesterRole": "USER",
    "targetUserId": "hashed-id",
    "requiredRole": "MANAGER"
  }
}

{
  "error": "EXPORT_SIZE_EXCEEDED", 
  "message": "Export would exceed maximum record limit",
  "code": 413,
  "details": {
    "recordCount": 50000,
    "maxRecords": 10000,
    "suggestion": "Use date range or department filters"
  }
}
```

### Support Escalation
For technical issues or compliance questions:
1. **Level 1**: Self-service documentation and FAQ
2. **Level 2**: IT helpdesk for access and permission issues  
3. **Level 3**: HR system administrators for policy questions
4. **Level 4**: Legal/compliance team for regulatory requirements

---

## Appendices

### A. Sample Export Files
- [Sample PDF Report (Public Data)](./samples/recognition-report-public.pdf)
- [Sample PDF Report (Full Data)](./samples/recognition-report-full.pdf) 
- [Sample CSV Export (Anonymized)](./samples/recognition-data-anonymized.csv)
- [Sample CSV Export (Full Data)](./samples/recognition-data-full.csv)

### B. API Reference
- [Export API Documentation](./api/export-endpoints.md)
- [Webhook Configuration](./api/webhooks.md)
- [SCIM Integration](./api/scim-integration.md)

### C. Compliance Checklists
- [GDPR Compliance Checklist](./compliance/gdpr-checklist.md)
- [SOX Audit Requirements](./compliance/sox-requirements.md)
- [Employment Law Considerations](./compliance/employment-law.md)

---

*This document is maintained by the HR Systems Team and updated quarterly. Last updated: December 2023*